# Production Configuration for Confluence MCP Server
# This profile is activated when running in production mode

# Application Configuration
spring.application.name=confluence-mcp-svr-prod
server.port=8081

# Production Logging Configuration (JSON structured logging)
logging.level.root=WARN
logging.level.io.github.greenstevester.confluencemcpsvr=INFO
logging.level.org.springframework.ai=INFO
logging.level.org.springframework.web=WARN

# Use JSON logging for production (better for log aggregation)
logging.pattern.console=%d{ISO8601} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=/app/logs/confluence-mcp-server.log
logging.file.max-size=10MB
logging.file.max-history=30
logging.file.total-size-cap=1GB

# Confluence API Configuration (from environment variables)
confluence.api.base-url=${CONFLUENCE_API_BASE_URL:https://${ATLASSIAN_SITE_NAME}.atlassian.net}
confluence.api.username=${CONFLUENCE_API_USERNAME:${ATLASSIAN_USER_EMAIL}}
confluence.api.token=${CONFLUENCE_API_TOKEN:${ATLASSIAN_API_TOKEN}}
confluence.api.timeout=30s
confluence.api.max-connections=50
confluence.api.retry-attempts=3

# MCP Server Configuration  
mcp.server.name=mcp-server-atlassian-confluence
mcp.server.version=2.0.1
mcp.server.description=MCP server for Atlassian Confluence (Production)

# Default Configuration
confluence.defaults.page-size=50
confluence.defaults.body-format=storage
confluence.defaults.include-labels=true
confluence.defaults.include-properties=false
confluence.defaults.include-webresources=false
confluence.defaults.include-collaborators=false
confluence.defaults.include-version=true

# Jackson Configuration
spring.jackson.default-property-inclusion=non_null
spring.jackson.deserialization.fail-on-unknown-properties=false
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.indent-output=false

# Validation Configuration
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false

# Security Headers
server.forward-headers-strategy=native
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain

# Connection Pool Configuration (production optimized)
server.tomcat.max-threads=200
server.tomcat.min-spare-threads=10
server.tomcat.accept-count=100
server.tomcat.max-connections=10000
server.tomcat.connection-timeout=30000

# Actuator Configuration (limited exposure for production)
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=when-authorized
management.metrics.export.prometheus.enabled=true
management.health.probes.enabled=true

# Health Check Configuration
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true
management.endpoint.health.group.liveness.include=ping
management.endpoint.health.group.readiness.include=ping

# Info Endpoint
info.app.name=@project.name@
info.app.version=@project.version@
info.app.encoding=@project.build.sourceEncoding@
info.app.java.version=@java.version@

# Graceful Shutdown
server.shutdown=graceful
spring.lifecycle.timeout-per-shutdown-phase=30s

# WebClient Configuration for Production
spring.webflux.hiddenmethod.filter.enabled=false